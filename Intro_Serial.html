<!DOCTYPE html>

<html lang="en">

<head>
  <title>Introduction Serial Dots</title>
  <script src="jspsych-6.0.4/jspsych.js"></script>
  <script src="jspsych-6.0.4/plugins/custom-manual-inhibition-serial.js"></script>
  <script src="jspsych-6.0.4/plugins/jspsych-html-button-response.js"></script>
  <script src="jspsych-6.0.4/plugins/jspsych-instructions.js"></script>
  <script src="jspsych-6.0.4/plugins/jspsych-fullscreen.js"></script>
  <script src="jatos.js"></script>
  <link href="styles.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" type="text/css" href="jspsych-6.0.4/css/jspsych.css">
  <!-- below, we prevent scaling and marking -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
</head>

<body bgcolor='gray'>

<script>

  // salute the hacker
  console.log('Wheee');

  // define all arrays we will need
  let timeline = [];
  let timelineVariables = [];

  // define booleans
  let lateResponse;
  let orderResponse;

  // define screen orientation to monitor user
  let scrOrientation;
  // get screen orientation information
  if (typeof screen.orientation === 'undefined'){
     // if screen.orientation doesn't work, check if the device is broader than high.
      scrOrientation = [screen.innerHeight<screen.innerWidth, 'rel']
  } else {
      scrOrientation = [screen.orientation.angle, 'angle']
  }

  // define all html style elements without their id (id is added in the plugin)
  let buttonVisible1 = "<dot style = 'background-color: rgb(0,0,0); left:calc(50% - 200px);'></dot>";
  let buttonVisible2 = "<dot style = 'background-color: rgb(0,0,0); left:calc(50% - 120px);'></dot>";
  let buttonVisible3 = "<dot style = 'background-color: rgb(0,0,0); left:calc(50% - 40px);'></dot>";
  let buttonVisible4 = "<dot style = 'background-color: rgb(0,0,0); right:calc(50% - 40px); margin-left:0; margin-right: -25px'></dot>";
  let buttonVisible5 = "<dot style = 'background-color: rgb(0,0,0); right:calc(50% - 120px); margin-left:0; margin-right: -25px'></dot>";
  let buttonVisible6 = "<dot style = 'background-color: rgb(0,0,0); right:calc(50% - 200px); margin-left:0; margin-right: -25px'></dot>";
  let visibleButtons = [buttonVisible1, buttonVisible2, buttonVisible3, buttonVisible4, buttonVisible5, buttonVisible6];

  let buttonInvisible1 = "<dot style = 'background-color: rgba(63,63,63,0); height:100px; width:100px; left:calc(50% - 200px); margin-left:-50px; margin-top: -50px'></dot>";
  let buttonInvisible2 = "<dot style = 'background-color: rgba(63,63,63,0); height:100px; width:100px; left:calc(50% - 120px); margin-left:-50px; margin-top: -50px'></dot>";
  let buttonInvisible3 = "<dot style = 'background-color: rgba(63,63,63,0); height:100px; width:100px; left:calc(50% - 40px); margin-left: -50px; margin-top: -50px'></dot>";
  let buttonInvisible4 = "<dot style = 'background-color: rgba(63,63,63,0); height:100px; width:100px; right:calc(50% - 40px); margin-left:0; margin-right: -50px; margin-top: -50px'></dot>";
  let buttonInvisible5 = "<dot style = 'background-color: rgba(63,63,63,0); height:100px; width:100px; right:calc(50% - 120px); margin-left:0; margin-right: -50px; margin-top: -50px'></dot>";
  let buttonInvisible6 = "<dot style = 'background-color: rgba(63,63,63,0); height:100px; width:100px; right:calc(50% - 200px); margin-left:0; margin-right: -50px; margin-top: -50px'></dot>";
  let invisibleButtons = [buttonInvisible1, buttonInvisible2, buttonInvisible3, buttonInvisible4, buttonInvisible5, buttonInvisible6];

  let flashUpVisible = "<div style = 'position:absolute; left:0; top:0; width:100%; height:calc(50% - 100px); background-color:rgba(255,255,255,1);-webkit-touch-callout: none; -webkit-user-select: none;'></div>";
  let flashDownVisible = "<div style = 'position:absolute; left:0; bottom:0; width:100%; height:calc(50% - 100px); background-color:rgba(255,255,255,1);-webkit-touch-callout: none; -webkit-user-select: none;'></div>";


  /* welcome message to jump tutorial */
  let serialtut_intro = {
    type: "instructions",
    pages: ["<p>This is the the second part of the experiment. We will start with a tutorial for you. </p>",
      "<p>In this block, six points will appear on screen in a row. </p>" +
      "<p>Touch all the points in order to collect them as fast as possible. </p>" +
      "<p>Press continue to begin.</p>"],
    show_clickable_nav: true,
    button_label_next: 'Ok. Continue >',
    post_trial_gap: 500,
    data: {
        test_part: 'serial_intro',
    }
  };
  timeline.push(serialtut_intro);

  // define one trial in which no flash is displayed, with 10 sec time to respond
  let noflash_serial = {
    type: 'manual-inhibition-serial',
    buttonsVisible: visibleButtons,
    buttonsInvisible: invisibleButtons,
    flashUp: '',
    flashDown: '',
    flashDuration: 0,
    flashTime: 0,
    trialDuration: 10000,
    waitAfter: 500,
    data:{
      test_part: 'serial_test_noflash',
    },
  };
  timeline.push(noflash_serial);

  // give more information on the trial
  let instructions_serial2 = {
    type: 'instructions',
    pages: ['<p>Well done. </p>' +
      '<p>While you are collecting the points, the upper and lower part of the display might turn white, producing a flash. </p>' +
      '<p>Try to ignore that flash.</p>' +
      '<p>&nbsp;</p>'+
      '<p>Try it again.</p>'],
    show_clickable_nav: true,
    button_label_next: 'Ok. Continue >',
    post_trial_gap: 500,
    data: {
      test_part: 'serial_instructions2',
    },
  };
  timeline.push(instructions_serial2);

  // show two trial with a flash, 5 seconds to answer, feedback will be provided
  let flash_serial = {
    type: 'manual-inhibition-serial',
    buttonsVisible: visibleButtons,
    buttonsInvisible: invisibleButtons,
    flashUp: flashUpVisible,
    flashDown: flashDownVisible,
    flashDuration: 50,
    flashTime: 400,
    trialDuration: 5000,
    waitAfter: 500,
    data:{
      test_part: 'serial_test_noflash',
    },
    on_finish:  function(data){
      orderResponse = data.orderResponse;
      lateResponse = data.lateResponse;
    },
  };

  // define the feedback structure
  let feedback = {
    type: 'html-button-response',
    stimulus: function () {
      if (lateResponse){
        return "<p>Too slow</p>"
      }
        else if (orderResponse) {
          return "<p>Well Done.</p>"
        } else {
          return "<p>Please follow the order.</p>"
        }
    },
    post_trial_gap: 500,
    choices: ['Next Trial'],
    data:{
      test_part: 'serial_test_feedback',
      response: !lateResponse&&orderResponse,
    },
  };

  // define the test procedure
  let test_procedure = {
    timeline: [flash_serial, feedback],
    repetitions: 2,
  };
  timeline.push(test_procedure);

  // add more instructions to the experiment
  let instructions_serial3 = {
    type: 'instructions',
    pages: ['<p>Great. Try to be as fast as possible in this part of the experiment, while collecting all dots in order. ' +
      'You can collect them forwards or backwards. If you collect them out of order, a warning will be displayed as a reminder. </p>' +
      '<p>We will start with a few training trials. </p>'],
    show_clickable_nav: true,
    button_label_next: 'Ok. Continue >',
    post_trial_gap: 500,
    trial_duration: 500,
    data: {
      test_part: 'serial_instructions',
    }
  };
  timeline.push(instructions_serial3);


  // load jatos and run the instructions
  jatos.onLoad(function () {

      jsPsych.data.addProperties({
        subject: jatos.workerId,
        screenWidth: screen.width,
        screenHeight: screen.height,
        userInfo: navigator.userAgent,
        platform: navigator.platform,
        scrPixDepth: screen.pixelDepth,
        scrColDepth : screen.colorDepth,
        scrOrientation: scrOrientation,
        scrResolution: window.devicePixelRatio,
        component: 'Intro_Serial',
      });

      jsPsych.init({
          timeline: timeline,
          fullscreen: true,
          on_finish: function() {
              var resultJson = jsPsych.data.get().json();
              jatos.submitResultData(resultJson, jatos.startNextComponent);
          }
      });
  });

</script>
</body>
</html>
