<!DOCTYPE html>

<html lang="en">

<head>
  <title>Experiment Serial Dots</title>
  <script src="jspsych-6.0.4/jspsych.js"></script>
  <script src="jspsych-6.0.4/plugins/jspsych-fullscreen.js"></script>
  <script src="jspsych-6.0.4/plugins/jspsych-html-button-response-serial.js"></script>
  <script src="jspsych-6.0.4/plugins/jspsych-html-button-response.js"></script>
  <script src="jatos.js"></script>
  <link rel="stylesheet" type="text/css" href="jspsych-6.0.4/css/jspsych.css">
  <style>
        p {
            font-size: 1em;
        }
        dot {
            position:absolute;
            display:inline;
            top: 50%;
            height: 50px;
            width: 50px;
            background-color: #000000;
            border-radius: 50%;
            margin-top: -25px;
            margin-left: -25px;
        }
  </style>

  <meta name="viewport" content="width=device-width">
</head>

<body bgcolor='gray'>
  <script>
      let serial_timeline = [];
      let responseGiven;
      let orientation;


      let buttonPoint1 = "<dot style = 'background-color: rgba(63,63,63,0); height:100px; width:100px; left:calc(50% - 200px); margin-left:-50px; margin-top: -50px'></dot>"+
              "<dot style = 'background-color: rgb(0,0,0); left:calc(50% - 200px);'></dot>";
      let buttonPoint2 = "<dot style = 'background-color: rgba(63,63,63,0); height:100px; width:100px; left:calc(50% - 120px); margin-left:-50px; margin-top: -50px'></dot>"+
              "<dot style = 'background-color: rgb(0,0,0); left:calc(50% - 120px);'></dot>";
      let buttonPoint3 = "<dot style = 'background-color: rgba(63,63,63,0); height:100px; width:100px; left:calc(50% - 40px); margin-left: -50px; margin-top: -50px'></dot>"+
              "<dot style = 'background-color: rgb(0,0,0); left:calc(50% - 40px);'></dot>";

       let buttonPoint4 = "<dot style = 'background-color: rgba(63,63,63,0); height:100px; width:100px; right:calc(50% - 40px); margin-left:0; margin-right: -50px; margin-top: -50px'></dot>"+
              "<dot style = 'background-color: rgb(0,0,0); right:calc(50% - 40px); margin-left:0; margin-right: -25px'></dot>";
      let buttonPoint5 = "<dot style = 'background-color: rgba(63,63,63,0); height:100px; width:100px; right:calc(50% - 120px); margin-left:0; margin-right: -50px; margin-top: -50px'></dot>"+
          "<dot style = 'background-color: rgb(0,0,0); right:calc(50% - 120px); margin-left:0; margin-right: -25px'></dot>";
      let buttonPoint6 = "<dot style = 'background-color: rgba(63,63,63,0); height:100px; width:100px; right:calc(50% - 200px); margin-left:0; margin-right: -50px; margin-top: -50px'></dot>"+
              "<dot style = 'background-color: rgb(0,0,0); right:calc(50% - 200px); margin-left:0; margin-right: -25px'></dot>";



      let confirm_fullscreen = {
          type: "fullscreen",
          message:["<p>Click below to change to fullscreen mode.</p>"],
          fullscreen_mode: true,
          button_label: 'Fullscreen',
          data: {
              test_part: 'fullscreen_request',
          }
      };

      serial_timeline.push(confirm_fullscreen);

      let trial = {
        type: 'html-button-response-serial',
        flash: true,
        stimulus: '',
        choices: ['','','','','',''],
        button_html: [buttonPoint1,buttonPoint2,buttonPoint3,buttonPoint4,buttonPoint5,buttonPoint6],
        post_trial_gap: 500,
        data:{
          test_part: 'Clicks',
        },
        on_finish:  function(data){
          let newA = [];
          for (let i = 1; i < data.choiceOrder.length; i++)  newA.push(data.choiceOrder[i] - data.choiceOrder[i - 1]);
          let absA = [];
          for (let i = 1; i<newA.length; i++) absA.push(Math.abs(newA[i]));

          responseGiven = absA.every( (val, i, arr) => val === 1 );
          console.log(responseGiven);
        },
      };

      let feedback = {
          type: 'html-button-response',
          button_html: [''],
          stimulus: function () {
              if (responseGiven) {
                  return "<p>Well Done.</p>"
              } else {
                  return "<p>Please follow the order.</p>"
              }
          },
          trial_duration: 1000,
          post_trial_gap: 500,
          choices: [''],
          data:{
              test_part: 'feedback',
              response: responseGiven,
          },
      };

      let test_procedure = {
        timeline: [trial, feedback],
        repetitions: 5,
      };
      serial_timeline.push(test_procedure);

       if (typeof screen.orientation === 'undefined'){
            orientation = [screen.innerHeight<screen.innerWidth, 'rel']
        } else {
            orientation = [screen.orientation.angle, 'angle']
        }

      jatos.onLoad(function () {
        jsPsych.data.addProperties({
            subject: jatos.workerId,
            screenWidth: screen.width,
            screenHeight: screen.height,
            userInfo: navigator.userAgent,
            platform: navigator.platform,
            scrPixDepth: screen.pixelDepth,
            scrColDepth : screen.colorDepth,
            scrOrientation: orientation,
            scrResolution: window.devicePixelRatio,
            component: 'Trials_Serial',
        });
          jsPsych.init({
              timeline: serial_timeline,
              fullscreen: true,
              on_finish: function() {
                  var resultJson = jsPsych.data.get().json();
                  jatos.submitResultData(resultJson, jatos.startNextComponent);
              }
          });
      });
  </script>
</body>>
</html>
